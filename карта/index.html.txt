<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ü—É—Ç–µ—à–µ—Å—Ç–≤—É–π —Å –Ω–∞–º–∏ | –°–ü–± –∏ –õ–û</title>
    
    <!-- –°—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.76.0/dist/L.Control.Locate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-search/3.0.9/leaflet-search.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-color: #2A9D8F;
            --secondary-color: #264653;
            --accent-color: #E9C46A;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255,255,255,0.98);
            z-index: 1000;
            padding: 12px 20px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .logo {
            display: flex;
            align-items: center;
            text-decoration: none;
        }

        .logo-svg {
            width: 45px;
            height: 45px;
            transition: transform 0.3s;
        }

        .logo:hover .logo-svg {
            transform: rotate(15deg) scale(1.1);
        }

        .logo-text {
            font-family: 'Arial Rounded MT Bold', sans-serif;
            color: var(--secondary-color);
            font-size: 1.8em;
            margin-left: 15px;
            letter-spacing: -0.5px;
        }

        #map {
            height: 100vh;
            width: 100%;
            margin-top: 70px;
        }

        @media (max-width: 768px) {
            .header { padding: 10px 15px; }
            .logo-svg { width: 38px; height: 38px; }
            .logo-text { font-size: 1.4em; }
            #map { margin-top: 60px; }
        }

        .leaflet-popup-content {
            min-width: 250px;
            max-width: 90vw !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

        .popup-header {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 8px;
            margin-bottom: 12px;
        }

        .transport-badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            margin: 4px;
            border-radius: 20px;
            font-size: 0.9em;
            background: #f8f9fa;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .badge-icon {
            margin-right: 8px;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <header class="header">
        <a href="#" class="logo">
            <svg class="logo-svg" viewBox="0 0 60 60">
                <path d="M30 5L5 55L55 55Z" fill="var(--primary-color)"/>
                <path d="M30 15C20 15 15 25 15 35Q30 45 45 35C45 25 40 15 30 15Z" fill="var(--secondary-color)"/>
                <path d="M25 40L30 50L35 40" fill="var(--accent-color)"/>
            </svg>
            <span class="logo-text">–ü—É—Ç–µ—à–µ—Å—Ç–≤—É–π —Å –Ω–∞–º–∏</span>
        </a>
    </header>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol@0.76.0/dist/L.Control.Locate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-search/3.0.9/leaflet-search.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    
    <script>
        const YANDEX_API_KEY = 'e351ac00-a75f-471e-a3f7-5848b489a533';
        const DATA_URL = 'data.csv';

        const map = L.map('map', {
            zoomControl: false,
            preferCanvas: true
        }).setView([59.93428, 30.335098], 10);

        L.tileLayer('https://core-renderer-tiles.maps.yandex.net/tiles?l=map&x={x}&y={y}&z={z}&scale=1&lang=ru_RU', {
            attribution: '¬© –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç—ã',
            maxZoom: 18
        }).addTo(map);

        const layers = {
            beaches: L.layerGroup(),
            lakes: L.layerGroup(),
            trails: L.layerGroup(),
            transport: L.layerGroup()
        };

        async function loadData() {
            const response = await fetch(DATA_URL);
            const csvData = await response.text();
            
            Papa.parse(csvData, {
                header: true,
                dynamicTyping: true,
                complete: ({data}) => {
                    data.forEach(item => {
                        const popupContent = `
                            <div class="popup-content">
                                <h3 class="popup-header">${item.title}</h3>
                                <img src="${item.photo}" style="width:100%; border-radius:8px; margin-bottom:12px;">
                                <p>${item.description}</p>
                                <div class="transport-info">
                                    ${item.bus ? `<div class="transport-badge"><span class="badge-icon">üöå</span>${item.bus}</div>` : ''}
                                    ${item.train ? `<div class="transport-badge"><span class="badge-icon">üöÜ</span>${item.train}</div>` : ''}
                                    ${item.car_time ? `<div class="transport-badge"><span class="badge-icon">üöó</span>${item.car_time} –º–∏–Ω</div>` : ''}
                                </div>
                            </div>
                        `;

                        const marker = L.marker([item.lat, item.lon], {
                            title: item.title
                        }).bindPopup(popupContent);

                        layers[item.type].addLayer(marker);
                    });

                    layers.beaches.addTo(map);
                    layers.lakes.addTo(map);
                    layers.trails.addTo(map);
                }
            });
        }

        loadData().then(() => {
            L.control.layers(null, {
                'üèñÔ∏è –ü–ª—è–∂–∏': layers.beaches,
                'üåä –û–∑–µ—Ä–∞': layers.lakes,
                'üå≤ –¢—Ä–æ–ø—ã': layers.trails
            }).addTo(map);

            L.control.zoom({ position: 'bottomleft' }).addTo(map);
            L.control.locate({
                position: 'bottomright',
                strings: { title: "–ú–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ" }
            }).addTo(map);
        });
    </script>
</body>
</html>